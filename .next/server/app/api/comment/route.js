(()=>{var e={};e.id=7201,e.ids=[7201],e.modules={12518:e=>{"use strict";e.exports=require("mongodb")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},20236:(e,s,t)=>{"use strict";t.r(s),t.d(s,{patchFetch:()=>h,routeModule:()=>p,serverHooks:()=>w,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>x});var o={};t.r(o),t.d(o,{GET:()=>m,POST:()=>d});var r=t(42706),n=t(28203),a=t(45994),c=t(52445),i=t(12518),l=t(39187),u=t(16656);async function d(e){console.log("POST /api/comment - Started");try{let s=await (0,u.d)(e);if(!s?.nickname)return console.log(s),l.NextResponse.json({success:!1,message:"로그인이 필요합니다"},{status:401});let t=await e.json();console.log("Request body:",t);let{text:o,postId:r,parentId:n}=t;if(!o?.trim())return console.log("Empty comment text"),l.NextResponse.json({success:!1,message:"댓글 내용을 입력해주세요"},{status:400});let a=(await c.X).db("forum");console.log("Connected to database");try{console.log("Checking post existence:",r);let e=await a.collection("posts").findOne({_id:new i.ObjectId(r)});if(console.log("Post found:",!!e),!e)return l.NextResponse.json({success:!1,message:"게시글을 찾을 수 없습니다"},{status:404})}catch(e){return console.error("Post lookup error:",e),l.NextResponse.json({success:!1,message:"잘못된 게시글 ID입니다"},{status:400})}if(n)try{if(!await a.collection("comments").findOne({_id:new i.ObjectId(n)}))return l.NextResponse.json({success:!1,message:"원본 댓글을 찾을 수 없습니다"},{status:404})}catch(e){return l.NextResponse.json({success:!1,message:"잘못된 댓글 ID입니다"},{status:400})}let d={text:o.trim(),postId:r,parentId:n||null,author:{username:s.username,nickname:s.nickname},createdAt:new Date},m=await a.collection("comments").insertOne(d);return l.NextResponse.json({success:!0,message:"댓글이 작성되었습니다",comment:{...d,_id:m.insertedId}})}catch(e){return console.error("POST comment error:",e),l.NextResponse.json({success:!1,message:"서버 오류가 발생했습니다",error:e.toString()},{status:500})}}async function m(e){console.log("GET /api/comment - Started");let s=new URL(e.url).searchParams.get("postId");if(console.log("Requested postId:",s),!s)return console.log("No postId provided"),l.NextResponse.json({success:!1,message:"게시글 ID가 필요합니다"},{status:400});try{let e=(await c.X).db("forum");console.log("Database connected");let t=await e.collection("comments").find({postId:s}).sort({createdAt:1}).toArray();return console.log(`Found ${t.length} comments`),console.log("Comments:",t),l.NextResponse.json({success:!0,comments:t})}catch(e){return console.error("GET comments error:",e),l.NextResponse.json({success:!1,message:"서버 오류가 발생했습니다",error:e.toString()},{status:500})}}let p=new r.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/comment/route",pathname:"/api/comment",filename:"route",bundlePath:"app/api/comment/route"},resolvedPagePath:"C:\\코딩\\p5\\forum\\app\\api\\comment\\route.js",nextConfigOutput:"",userland:o}),{workAsyncStorage:g,workUnitAsyncStorage:x,serverHooks:w}=p;function h(){return(0,a.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:x})}},96487:()=>{},78335:()=>{},16656:(e,s,t)=>{"use strict";async function o(e){try{console.log("[Middleware] Request headers:",Object.fromEntries(e.headers));let s=e.headers.get("Authorization")?.replace("Bearer ","");if(!s)return console.log("[Middleware] No authorization header found"),null;console.log("[Middleware] Raw authorization:",s);try{let e=atob(s);console.log("[Middleware] Decoded base64:",e);let t=decodeURIComponent(e);console.log("[Middleware] Decoded URI:",t);let o=JSON.parse(t);if(console.log("[Middleware] Final parsed auth:",o),!o.username||!o.nickname)return console.log("[Middleware] Missing required fields:",{hasUsername:!!o.username,hasNickname:!!o.nickname}),null;return o}catch(e){return console.error("[Middleware] Parsing error:",{error:e.message,stack:e.stack}),null}}catch(e){return console.error("[Middleware] Validation error:",{error:e.message,stack:e.stack}),null}}t.d(s,{d:()=>o})},52445:(e,s,t)=>{"use strict";t.d(s,{X:()=>n});var o=t(12518);let r=process.env.MONGODB_URI;if(!process.env.MONGODB_URI)throw Error("Please add your Mongo URI to .env.local");let n=new o.MongoClient(r,{}).connect()}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),o=s.X(0,[638,5452],()=>t(20236));module.exports=o})();