(()=>{var e={};e.id=3775,e.ids=[3775],e.modules={12518:e=>{"use strict";e.exports=require("mongodb")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},33404:(e,s,r)=>{"use strict";r.r(s),r.d(s,{patchFetch:()=>k,routeModule:()=>m,serverHooks:()=>x,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>w});var t={};r.r(t),r.d(t,{GET:()=>p,POST:()=>l});var o=r(42706),n=r(28203),a=r(45994),i=r(52445),u=r(12518),d=r(39187),c=r(16656);async function l(e,{params:s}){try{let r=await (0,c.d)(e);if(console.log("[Like] User:",r),!r?.username)return d.NextResponse.json({success:!1,message:"로그인이 필요합니다"},{status:401});let t=(await i.X).db("forum"),o=await t.collection("posts").findOne({_id:new u.ObjectId(s.id)});if(!o)return d.NextResponse.json({success:!1,message:"게시글을 찾을 수 없습니다"},{status:404});let n=o.likedBy||[],a=n.indexOf(r.username);return -1===a?n.push(r.username):n.splice(a,1),await t.collection("posts").updateOne({_id:new u.ObjectId(s.id)},{$set:{likedBy:n}}),d.NextResponse.json({success:!0,updatedLikedBy:n,message:-1===a?"좋아요!":"좋아요 취소"})}catch(e){return console.error("Like error:",e),d.NextResponse.json({success:!1,message:"서버 오류가 발생했습니다"},{status:500})}}async function p(e,{params:s}){try{let r=await (0,c.d)(e);if(!r?.username)return d.NextResponse.json({success:!0,liked:!1});let t=(await i.X).db("forum"),o=await t.collection("posts").findOne({_id:new u.ObjectId(s.id)});if(!o)return d.NextResponse.json({success:!1,message:"게시글을 찾을 수 없습니다"},{status:404});let n=o.likedBy?.includes(r.username)||!1;return d.NextResponse.json({success:!0,liked:n})}catch(e){return console.error("Get like status error:",e),d.NextResponse.json({success:!1,message:"서버 오류가 발생했습니다"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/posts/[id]/like/route",pathname:"/api/posts/[id]/like",filename:"route",bundlePath:"app/api/posts/[id]/like/route"},resolvedPagePath:"C:\\코딩\\p5\\forum\\app\\api\\posts\\[id]\\like\\route.js",nextConfigOutput:"",userland:t}),{workAsyncStorage:g,workUnitAsyncStorage:w,serverHooks:x}=m;function k(){return(0,a.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:w})}},96487:()=>{},78335:()=>{},16656:(e,s,r)=>{"use strict";async function t(e){try{console.log("[Middleware] Request headers:",Object.fromEntries(e.headers));let s=e.headers.get("Authorization")?.replace("Bearer ","");if(!s)return console.log("[Middleware] No authorization header found"),null;console.log("[Middleware] Raw authorization:",s);try{let e=atob(s);console.log("[Middleware] Decoded base64:",e);let r=decodeURIComponent(e);console.log("[Middleware] Decoded URI:",r);let t=JSON.parse(r);if(console.log("[Middleware] Final parsed auth:",t),!t.username||!t.nickname)return console.log("[Middleware] Missing required fields:",{hasUsername:!!t.username,hasNickname:!!t.nickname}),null;return t}catch(e){return console.error("[Middleware] Parsing error:",{error:e.message,stack:e.stack}),null}}catch(e){return console.error("[Middleware] Validation error:",{error:e.message,stack:e.stack}),null}}r.d(s,{d:()=>t})},52445:(e,s,r)=>{"use strict";r.d(s,{X:()=>n});var t=r(12518);let o=process.env.MONGODB_URI;if(!process.env.MONGODB_URI)throw Error("Please add your Mongo URI to .env.local");let n=new t.MongoClient(o,{}).connect()}};var s=require("../../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[638,5452],()=>r(33404));module.exports=t})();