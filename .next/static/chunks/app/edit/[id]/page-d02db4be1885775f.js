(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1615],{2819:(e,t,a)=>{Promise.resolve().then(a.bind(a,259))},259:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var l=a(5155),s=a(6046),r=a(2115),n=a(473),i=a(6475),c=a(3750);function o(){let[e,t]=(0,r.useState)(""),[a,o]=(0,r.useState)(""),[d,h]=(0,r.useState)(""),u=(0,s.useRouter)(),{id:f}=(0,s.useParams)();(0,r.useEffect)(()=>{if(!(0,c.C)()){u.push("/login");return}(async()=>{try{if(!f)return;let e=await fetch("/api/post/".concat(f));if(!e.ok)throw Error("게시물을 가져오는데 실패했습니다");let a=await e.json();if(!a)throw Error("데이터가 없습니다");t(a.title),o(a.content),h(a.author)}catch(e){alert(e.message),u.push("/list")}})()},[f,u]);let m=async t=>{t.preventDefault();let l=(0,c.C)();if(!l){alert("로그인이 필요합니다"),u.push("/login");return}if(l.nickname!==d){alert("작성자만 수정할 수 있습니다");return}let s=await fetch("/api/post/edit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:f,title:e.trim(),content:a.trim(),author:l.nickname})});if(!s.ok)throw Error((await s.json()).message||"게시글 수정에 실패했습니다");alert("글이 성공적으로 수정되었습니다!"),u.push("/list/detail/".concat(f))};return(0,l.jsxs)("div",{children:[(0,l.jsx)(n.default,{}),(0,l.jsx)("p",{className:"write-title",children:"글 수정 페이지"}),(0,l.jsxs)("form",{onSubmit:m,children:[(0,l.jsx)("input",{type:"text",className:"write-input",placeholder:"제목",value:e,onChange:e=>t(e.target.value)}),(0,l.jsx)("textarea",{className:"write-input",placeholder:"내용",value:a,onChange:e=>o(e.target.value),rows:10}),(0,l.jsx)(i.A,{postId:f,isEditMode:!0,currentUser:(0,c.C)(),postAuthor:d}),(0,l.jsx)("button",{type:"submit",className:"write-submit-button",children:(0,l.jsx)("p",{className:"write-submit-text",children:"제출"})})]})]})}},6475:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var l=a(5155),s=a(2115);function r(e){let{postId:t,isEditMode:a=!1,currentUser:r,postAuthor:n}=e,[i,c]=(0,s.useState)([]),[o,d]=(0,s.useState)(!1),[h,u]=(0,s.useState)(!1);(0,s.useEffect)(()=>{f()},[t]);let f=async()=>{try{let e=await fetch("/api/files/".concat(t));if(e.ok){let t=await e.json();c(t)}}catch(e){console.error("파일 목록 로딩 실패:",e)}},m=async e=>{let a=Array.from(e.target.files);for(let e of a)if(e.size>5242880){alert("".concat(e.name,"의 크기가 5MB를 초과합니다."));return}d(!0);try{for(let e of a){let a=new FormData;if(a.append("file",e),!(await fetch("/api/files/".concat(t),{method:"POST",body:a})).ok)throw Error("파일 업로드 실패: ".concat(e.name))}f()}catch(e){console.error("파일 업로드 실패:",e),alert("파일 업로드 중 오류가 발생했습니다.")}finally{d(!1)}},p=(e,t)=>{try{let a="".concat(window.location.origin).concat(e);console.log("Download URL:",a);let l=document.createElement("a");l.href=a,l.download=t||"download",document.body.appendChild(l),l.click(),document.body.removeChild(l)}catch(e){console.error("Download error:",e),alert("파일 다운로드 중 오류가 발생했습니다.")}},j=async e=>{if(window.confirm("파일을 삭제하시겠습니까?"))try{if((await fetch("/api/files/".concat(e),{method:"DELETE"})).ok)f();else throw Error("파일 삭제 실패")}catch(e){console.error("파일 삭제 오류:",e),alert("파일 삭제 중 오류가 발생했습니다.")}},x=a||(null==r?void 0:r.nickname)===n;return(0,l.jsxs)("div",{className:"files-section",children:[(0,l.jsx)("div",{className:"files-header",onClick:()=>u(!h),children:(0,l.jsxs)("h3",{children:["첨부 파일 (",i.length,")",(0,l.jsx)("span",{className:"toggle-icon",children:h?"▼":"▶"})]})}),h&&(0,l.jsxs)(l.Fragment,{children:[x&&(0,l.jsxs)("div",{className:"file-upload-section",children:[(0,l.jsxs)("label",{className:"file-upload-label",children:["파일 첨부하기",(0,l.jsx)("input",{type:"file",onChange:m,className:"hidden",multiple:!0,accept:"*/*"})]}),(0,l.jsx)("p",{className:"file-info",children:"* 파일당 최대 5MB"}),o&&(0,l.jsx)("p",{children:"업로드 중..."})]}),i.length>0?(0,l.jsx)("div",{className:"file-grid",children:i.map((e,t)=>(0,l.jsxs)("div",{className:"file-download-item",children:[(0,l.jsx)("span",{className:"file-name",title:e.filename,children:e.filename}),(0,l.jsxs)("span",{className:"file-size",children:[(e.size/1024).toFixed(1),"KB"]}),(0,l.jsx)("button",{className:"file-download",onClick:()=>p(e.filepath,e.filename),children:"다운로드"}),x&&(0,l.jsx)("button",{className:"file-delete",onClick:()=>j(e._id),children:"삭제"})]},t))}):(0,l.jsx)("p",{className:"no-files",children:"첨부된 파일이 없습니다"})]})]})}},473:(e,t,a)=>{"use strict";a.d(t,{default:()=>c});var l=a(5155),s=a(2115),r=a(8173),n=a.n(r),i=a(6046);let c=()=>{let[e,t]=(0,s.useState)(null),[a,r]=(0,s.useState)(!1),c=(0,i.useRouter)();return(0,s.useEffect)(()=>{let e=localStorage.getItem("user");e&&t(JSON.parse(e))},[]),(0,l.jsxs)("nav",{className:"navbar",children:[(0,l.jsxs)("div",{className:"nav-left",children:[(0,l.jsx)(n(),{href:"/",className:"nav-link",children:"홈"}),(0,l.jsx)(n(),{href:"/list",className:"nav-link",children:"게시판"})]}),(0,l.jsx)("div",{className:"nav-right",children:e?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n(),{href:"/write",className:"nav-link write-btn",children:"글쓰기"}),(0,l.jsx)(n(),{href:"/profile",className:"nav-link",children:"프로필"}),(0,l.jsx)("button",{onClick:()=>{localStorage.removeItem("user"),t(null),c.push("/login")},className:"nav-link",children:"로그아웃"})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n(),{href:"/login",className:"nav-link",children:"로그인"}),(0,l.jsx)(n(),{href:"/register",className:"nav-link",children:"회원가입"})]})})]})}},3750:(e,t,a)=>{"use strict";a.d(t,{C:()=>l,G:()=>s});let l=()=>{try{let e=localStorage.getItem("user");if(!e)return null;let t=JSON.parse(e);if(!t||"object"!=typeof t)return localStorage.removeItem("user"),null;return t}catch(e){return console.error("Local storage parsing error:",e),localStorage.removeItem("user"),null}},s=e=>e&&"object"==typeof e&&"string"==typeof e.nickname&&e.nickname.length>0}},e=>{var t=t=>e(e.s=t);e.O(0,[1028,8441,1517,7358],()=>t(2819)),_N_E=e.O()}]);